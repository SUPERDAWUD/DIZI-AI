<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Developer Panel</title>
    <link rel="stylesheet" href="/static/style.css">
    <style>
        body { background: #181a1b; color: #eee; font-family: Arial, sans-serif; }
        .container { max-width: 800px; margin: 40px auto; background: #222; padding: 32px; border-radius: 12px; box-shadow: 0 2px 16px #0006; }
        h1 { color: #7fd957; }
        .section { margin-bottom: 32px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; }
        input, textarea, select { width: 100%; padding: 8px; margin-bottom: 16px; border-radius: 6px; border: 1px solid #444; background: #181a1b; color: #eee; }
        button { background: #7fd957; color: #222; border: none; padding: 10px 24px; border-radius: 6px; cursor: pointer; font-weight: bold; }
        button:hover { background: #6fc947; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Developer Panel</h1>
        <div class="section">
            <h2>Welcome to the Developer Panel!</h2>
            <p>If you see this page, you are logged in as a developer. All dev tools are available below.</p>
        </div>
    <div class="section">
      <h2>Gemini Model Info</h2>
      <form action="/dev/gemini_models" method="get">
        <button type="submit">List Gemini Models</button>
      </form>
    </div>
    <div class="section">
      <h2>Inference Device</h2>
      <label for="device-select">Choose device:</label>
      <select id="device-select" onchange="switchDevice()">
        <option value="auto">Auto</option>
        <option value="cuda">GPU (CUDA)</option>
        <option value="cpu">CPU</option>
      </select>
      <span id="device-status" style="margin-left:1em;color:#7fd957;"></span>
    </div>
  <script>
  function switchDevice() {
    const device = document.getElementById('device-select').value;
    fetch('/api/set-device', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ device })
    })
    .then(res => res.json())
    .then(data => {
      document.getElementById('device-status').textContent = 'Now using: ' + data.device;
    });
  }
  </script>
        <div class="section">
            <h2>Run Code</h2>
            <form action="/dev/exec" method="post">
                <label for="code">Code:</label>
                <textarea name="code" id="code" rows="6"></textarea>
                <label for="language">Language:</label>
                <select name="language" id="language">
                    <option value="python">Python</option>
                    <option value="javascript">JavaScript</option>
                    <option value="bash">Bash</option>
                    <option value="java">Java</option>
                    <option value="c++">C++</option>
                </select>
                <button type="submit">Run</button>
            </form>
        </div>
        <div class="section">
            <h2>Self-Modify Code</h2>
            <form action="/dev/self-modify" method="post">
                <label for="new_code">New Code:</label>
                <textarea name="new_code" id="new_code" rows="6"></textarea>
                <label for="target_file">Target File:</label>
                <input type="text" name="target_file" id="target_file" placeholder="e.g. chat.py">
                <button type="submit">Modify</button>
            </form>
        </div>
        <div class="section">
            <h2>User Personality (Pie Chart)</h2>
            <canvas id="personalityChart" width="400" height="400"></canvas>
        </div>
        <div class="section">
            <h2>Questions Asked by Users</h2>
            <table style="width:100%;background:#222;color:#eee;border-radius:8px;">
                <thead>
                    <tr style="background:#333;color:#7fd957;"><th>User</th><th>Question</th></tr>
                </thead>
                <tbody id="questionsTableBody"></tbody>
            </table>
        </div>
        <div class="section">
            <h2>Live Chat Console</h2>
            <div id="live-console" style="background:#111;padding:1em;border-radius:8px;max-height:300px;overflow-y:auto;font-family:monospace;"></div>
            <button onclick="refreshConsole()">Refresh Console</button>
        </div>
        <div class="section">
            <a href="/dev/code-assistant"><button style="background:#222;color:#7fd957;padding:0.7em 1.5em;border-radius:8px;font-size:1.1em;">Coding Assistant</button></a>
        </div>    <div class="section">
      <h2>Aggregation & Reasoning</h2>
      <label for="agg-select">Aggregation mode:</label>
      <select id="agg-select" onchange="switchAgg()">
        <option value="parallel">Parallel (synthesize from all)</option>
        <option value="priority">Priority (pick best source)</option>
      </select>
      <br/>
      <label for="reasoning-select">Reasoning mode:</label>
      <select id="reasoning-select" onchange="switchReasoning()">
        <option value="auto">Auto</option>
        <option value="on">On</option>
        <option value="off">Off</option>
      </select>
      <br/>
      <label for="reasoning-level-select">Reasoning level:</label>
      <select id="reasoning-level-select" onchange="switchReasoningLevel()">
        <option value="low">Low (fast)</option>
        <option value="medium" selected>Medium</option>
        <option value="high">High (best)</option>
      </select>
      <br/>
      <label><input type="checkbox" id="prefer-local-stream" onchange="togglePreferLocal()"> Prefer local streaming</label>
      <span id="agg-status" style="margin-left:1em;color:#7fd957;"></span>
    </div>
    <div class="section">
      <h2>Images</h2>
      <label for="image-backend">Image backend:</label>
      <select id="image-backend" onchange="switchImageBackend()">
        <option value="auto" selected>Auto (Gemini â†’ Replicate)</option>
        <option value="gemini">Gemini only</option>
        <option value="replicate">Replicate only</option>
      </select>
      <span id="image-backend-status" style="margin-left:1em;color:#7fd957;"></span>
    </div>
    <div class="section">
      <h2>System Prompt & Generation</h2>
      <label for="system-prompt">Custom system instructions:</label>
      <textarea id="system-prompt" rows="4" placeholder="e.g., You are a concise, expert assistant..."></textarea>
      <label>Temperature: <span id="temp-val">0.7</span></label>
      <input id="temp-range" type="range" min="0" max="1" step="0.05" value="0.7" oninput="document.getElementById('temp-val').textContent=this.value">
      <label>Top-p: <span id="topp-val">0.95</span></label>
      <input id="topp-range" type="range" min="0" max="1" step="0.05" value="0.95" oninput="document.getElementById('topp-val').textContent=this.value">
      <label>Max tokens:</label>
      <input id="max-tokens" type="number" min="64" max="2048" value="256"/>
      <button onclick="applyGenParams()">Apply</button>
      <span id="gen-params-status" style="margin-left:1em;color:#7fd957;"></span>
    </div>
    <div class="section">
      <h2>GPU Diagnostics</h2>
      <button onclick="gpuDiag()">Run GPU Diagnostics</button>
      <pre id="gpu-diag" style="max-height:220px;overflow:auto;background:#111;padding:1em;border-radius:6px;"></pre>
    </div>
    <div class="section">
      <h2>GPU Control</h2>
      <button onclick="forceGPU()">Force GPU (set CUDA + move model)</button>
      <label style="margin-left:10px;">Quantization:</label>
      <select id="quantization">
        <option value="">(none)</option>
        <option value="8bit">8-bit</option>
        <option value="4bit">4-bit</option>
      </select>
      <span id="forcegpu-status" style="margin-left:1em;color:#7fd957;"></span>
    </div>
    <div class="section">
      <h2>Vectors (RAG)</h2>
      <button onclick="reindexRag()">Rebuild Vector Index</button>
      <input id="rag-query" placeholder="Query vector index"/>
      <button onclick="queryRag()">Search</button>
      <pre id="rag-results" style="max-height:200px;overflow:auto;background:#111;padding:1em;border-radius:6px;"></pre>
    </div>
    <div class="section">
      <h2>Web Summarization</h2>
      <input id="web-url" placeholder="https://example.com/article"/>
      <input id="web-question" placeholder="Optional focus question"/>
      <button onclick="summarizeUrl()">Summarize URL</button>
      <input id="web-search" placeholder="Search the web"/>
      <button onclick="searchWeb()">Search + Summarize</button>
      <pre id="web-output" style="max-height:200px;overflow:auto;background:#111;padding:1em;border-radius:6px;"></pre>
    </div></div><script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
// --- Personality Pie Chart ---
const userData = {
  Dawud: {
    personality: {
      formality: "low",
      humor: "high",
      directness: "low",
      preferred_tone: "humorous",
      emoji_usage: "high",
      greeting_style: "high"
    }
  }
};
const traitLabels = Object.keys(userData.Dawud.personality);
const traitValues = traitLabels.map(l => {
  const v = userData.Dawud.personality[l];
  if (v === "high") return 3;
  if (v === "humorous") return 2;
  if (v === "low") return 1;
  return 2;
});
const traitColors = ["#7fd957", "#ff6b6b", "#6fc947", "#f7c948", "#57d9c7", "#d957a3"];
new Chart(document.getElementById('personalityChart'), {
  type: 'pie',
  data: {
    labels: traitLabels,
    datasets: [{
      data: traitValues,
      backgroundColor: traitColors
    }]
  },
  options: {
    plugins: { legend: { labels: { color: '#eee' } } }
  }
});
// --- Questions Table ---
const userQuestions = {
  Dawud: [
    "hello", "quit", "write me a speech about lions", "hello", "quit", "hello", "who is elon musk", "can you generate code in python to print hello world", "Thanks", "hello", "whats 2+3", "no whats 2+3", "generate me a picture of a jungle", "whats 1+1", "1+1", "1+1", "1+1", "7+8", "8*9", "whats 2*2", "2+2", "generate me an image of a zoo", "create image of a zoo", "write me a python program that allows me to make a list", "can you write me the code", "write me code that prints hello to the console in Java script", "hello", "who is donald trump", "777097908*9999999", "890809/3", "cos(7)", "bye", "quit", "Bye", "See you later", "hello", "hi", "Hello", "hello", "Hello", "yo", "Yo", "quiy", "Yo", "hello", "can you tell me about trumps deployment of troops in LA", "what about marines", "tell me how many marines he deployed in LA", "how many marines deployed in la", "elon musk", "Hi", " many marines did trump deploy in la", "marines", "what are marines", "marines", "hfaoshuohfds", "sfaaaaasfaaaaaaaa", "quit", "who is elon musk", "elon musk", "Who is donald j trump", "who is elon musk", "in javascript how do i print to the console", "ok whats the weather in virgina right now", "what time is it", "what time is it in VA", "time in VA", "who made you", "who created you", "Who created you", "ok cool", "YO", "what time is magrib", "whats the weather in springfield va", "weather in va", "BYE", "whats the time", "What time is it", "Make a speech about black holes", "jfiolshdfosd", "whats 2+2"
  ],
  Zayd: ["whats 1+1", "whos elon musk", "write me a speech about lions"]
};
const tbody = document.getElementById('questionsTableBody');
Object.entries(userQuestions).forEach(([user, questions]) => {
  questions.forEach(q => {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${user}</td><td>${q}</td>`;
    tbody.appendChild(tr);
  });
});
    </script>
    <script>
    async function refreshConsole() {
      const res = await fetch('/api/chats');
      const chats = await res.json();
      const consoleDiv = document.getElementById('live-console');
      consoleDiv.innerHTML = '';
      chats.forEach(chat => {
        // Show both user and bot messages (if available)
        consoleDiv.innerHTML += `<div><strong>User:</strong> ${chat.title}<br><strong>Bot:</strong> ${chat.timestamp}</div><hr>`;
      });
    }
    // Auto-refresh every 10 seconds
    setInterval(refreshConsole, 10000);
    refreshConsole();
      async function switchAgg() {
    const mode = document.getElementById('agg-select').value;
    const res = await fetch('/api/set-aggregation-mode', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({mode}) });
    const data = await res.json();
    document.getElementById('agg-status').textContent = 'Aggregation: ' + (data.mode||'unknown');
  }
  function switchReasoning() {
    const mode = document.getElementById('reasoning-select').value;
    document.getElementById('agg-status').textContent = 'Reasoning (set env REASONING_MODE=' + mode + ')';
  }
  async function switchReasoningLevel(){
    const level = document.getElementById('reasoning-level-select').value;
    const res = await fetch('/api/set-reasoning-level', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({level}) });
    const data = await res.json();
    document.getElementById('agg-status').textContent = 'Reasoning level: ' + (data.level||level);
  }
  async function togglePreferLocal(){
    const prefer_local = document.getElementById('prefer-local-stream').checked;
    const res = await fetch('/api/set-prefer-local-stream', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({prefer_local}) });
    const data = await res.json();
    document.getElementById('agg-status').textContent = 'Prefer local stream: ' + (data.prefer_local_stream?'on':'off');
  }
  async function switchImageBackend(){
    const mode = document.getElementById('image-backend').value;
    const res = await fetch('/api/set-image-backend', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({mode}) });
    const data = await res.json();
    document.getElementById('image-backend-status').textContent = 'Image backend: ' + (data.mode||'unknown');
  }
  async function gpuDiag(){
    const res = await fetch('/api/diagnostics/gpu');
    const data = await res.json();
    document.getElementById('gpu-diag').textContent = JSON.stringify(data, null, 2);
  }
  async function forceGPU(){
    const q = document.getElementById('quantization').value;
    const res = await fetch('/api/force-gpu', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ quantization: q })});
    const data = await res.json();
    const ok = data && data.ok && data.info && data.info.cuda_available;
    const msg = ok ? ('CUDA OK on ' + (data.info.device_name||'')) : ('CUDA not available. torch='+ (data.info?.torch_version||'?'));
    document.getElementById('forcegpu-status').textContent = msg;
    gpuDiag();
  }
  async function reindexRag(){
    const res = await fetch('/api/rag/reindex', {method:'POST'});
    const data = await res.json();
    alert('RAG reindex: ' + (data.message || data.ok));
  }
  async function queryRag(){
    const q = document.getElementById('rag-query').value;
    const res = await fetch('/api/rag/query', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({query:q, top_k:5})});
    const data = await res.json();
    document.getElementById('rag-results').textContent = JSON.stringify(data.hits || [], null, 2);
  }
  async function summarizeUrl(){
    const url = document.getElementById('web-url').value;
    const query = document.getElementById('web-question').value;
    const res = await fetch('/api/web-summarize', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({url, query})});
    const data = await res.json();
    document.getElementById('web-output').textContent = JSON.stringify(data.result || data, null, 2);
  }
  async function searchWeb(){
    const query = document.getElementById('web-search').value;
    const res = await fetch('/api/web-summarize', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({query, num_results:3})});
    const data = await res.json();
    document.getElementById('web-output').textContent = JSON.stringify(data.result || data, null, 2);
  }
  async function applyGenParams(){
    const system_prompt = document.getElementById('system-prompt').value;
    const temperature = parseFloat(document.getElementById('temp-range').value);
    const top_p = parseFloat(document.getElementById('topp-range').value);
    const max_tokens = parseInt(document.getElementById('max-tokens').value||'256');
    const res = await fetch('/api/set-user-prefs', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ system_prompt, temperature, top_p, max_tokens })});
    const data = await res.json();
    document.getElementById('gen-params-status').textContent = data.ok ? 'Applied' : 'Failed';
  }
  </script></body>
</html>


